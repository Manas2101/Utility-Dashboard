<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Utility Details - {{ utility.title if utility else 'Not Found' }}</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

  <style>

    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

    :root {

      --hsbc-red:#DB0011; --hsbc-red-darker:#A9000D; --hsbc-black:#fff; --hsbc-charcoal:rgba(255,255,255,0.9); --hsbc-medium:rgba(255,255,255,0.6); --hsbc-light:rgba(255,255,255,0.1); --hsbc-vlight:rgba(255,255,255,0.05); --bg:#0a0e27; --white:rgba(255,255,255,0.03);

      --run-bg:rgba(0,135,90,0.2); --run-text:#00FF88; --impl-bg:rgba(255,165,0,0.2); --impl-text:#FFB84D;

    }

    * {box-sizing:border-box;}

    body {font-family:'Inter','Helvetica Neue',Arial,sans-serif;margin:0;background:var(--bg);color:var(--hsbc-charcoal);font-size:14px;line-height:1.6;min-height:100vh;position:relative;overflow-x:hidden;}

    body::before {content:''; position:fixed; top:0; left:0; right:0; bottom:0; background:radial-gradient(circle at 20% 50%, rgba(219,0,17,0.15) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(0,135,90,0.1) 0%, transparent 50%); pointer-events:none; z-index:0;}

    .container {max-width:900px;margin:40px auto;padding:40px;background:rgba(255,255,255,0.03);backdrop-filter:blur(20px);border-radius:24px;box-shadow:0 8px 32px rgba(0,0,0,.3), inset 0 1px 0 rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.08);position:relative;z-index:1;}    

  h1 {margin:0 0 8px;font-size:28px;font-weight:700;color:#fff;display:flex;align-items:center;gap:12px;text-shadow:0 2px 20px rgba(219,0,17,0.3);}

  h1 .mini-icon {width:32px;height:32px;object-fit:contain;border:1px solid rgba(255,255,255,0.2);border-radius:8px;background:rgba(255,255,255,0.05);padding:4px;}

    .header {display:flex;align-items:center;margin-bottom:24px;gap:20px;}

    .header img {width:72px;height:72px;object-fit:contain;border-radius:12px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.05);}

    .status-badge {display:inline-block;padding:6px 12px;border-radius:16px;font-size:12px;font-weight:700;text-transform:capitalize;border:1px solid;}

    .status-running {background:var(--run-bg);color:var(--run-text);border-color:rgba(0,255,136,0.3);}    

    .status-implementing,.status-implementation {background:var(--impl-bg);color:var(--impl-text);border-color:rgba(255,184,77,0.3);}

    table {width:100%;border-collapse:collapse;margin:16px 0 32px;font-size:14px;}

    th {text-align:left;background:rgba(255,255,255,0.05);padding:12px 16px;font-size:11px;font-weight:700;letter-spacing:.6px;text-transform:uppercase;color:rgba(255,255,255,0.7);border-bottom:1px solid rgba(255,255,255,0.1);}

    td {padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.08);color:rgba(255,255,255,0.85);}    

    td a {color:#00FF88;text-decoration:none;border-bottom:1px solid rgba(0,255,136,0.3);transition:all .3s;}

    td a:hover {color:#00FFaa;border-bottom-color:#00FF88;}

    tbody tr:last-child td {border-bottom:none;}

    pre {background:rgba(0,0,0,0.4);padding:16px 18px;border-radius:12px;overflow:auto;font-size:13px;margin:0;color:#d2e2ff;border:1px solid rgba(255,255,255,0.1);line-height:1.5;}

    .config-wrapper {position:relative;}

    .copy-btn {position:absolute;top:10px;right:10px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);border-radius:20px;padding:7px 12px;cursor:pointer;font-size:12px;color:rgba(255,255,255,0.9);transition:all .3s;}

    .copy-btn:hover {background:rgba(255,255,255,0.15);border-color:rgba(219,0,17,0.5);}

    .back {text-decoration:none;display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,0.15);padding:10px 16px;border-radius:12px;font-size:14px;color:rgba(255,255,255,0.9);background:rgba(255,255,255,0.05);transition:all .3s;}

    .back:hover {background:rgba(255,255,255,0.1);border-color:rgba(219,0,17,0.5);transform:translateX(-4px);}    

    .not-found {text-align:center;padding:60px 0;}

    /* Edit form styling */

    .edit-form {display:flex;flex-direction:column;gap:12px;}

    .field {display:flex;flex-direction:column;gap:6px;}

    .field label {font-size:12px;color:rgba(255,255,255,0.7);font-weight:600;}

    .input {width:100%;padding:12px 16px;border:1px solid rgba(255,255,255,0.1);border-radius:12px;background:rgba(255,255,255,0.05);color:#fff;}

    .textarea {min-height:100px;}

    .submit {background:linear-gradient(135deg,#DB0011,#FF4444);color:#fff;border:none;padding:12px 20px;border-radius:12px;cursor:pointer;align-self:flex-start;box-shadow:0 4px 16px rgba(219,0,17,.4);transition:all .3s;font-weight:600;}

    .submit:hover {transform:translateY(-2px);box-shadow:0 6px 24px rgba(219,0,17,.6);}

    .note {font-size:12px;color:rgba(255,255,255,0.5);}  

    #toggleEdit {background:var(--hsbc-red);color:#fff;border:none;}

  </style>

</head>

<body>

  <div class="container">

    {% if utility %}

      <div class="header">

        <h1>

          {% if utility.icon_url %}<img class="mini-icon" src="/{{ app_name }}/{{ utility.icon_url }}" alt="{{ utility.title }} icon" onerror="this.style.display='none'" />{% endif %}

          {{ utility.title }}

        </h1>

        <button id="editUtilityBtn" class="submit" style="margin-left:auto;">Edit Utility</button>

      </div>

      <table>

        <tbody>

          <tr><th>Status</th><td><span class="status-badge status-{{ utility.status|lower }}">{{ utility.status }}</span></td></tr>

          <tr><th>Description</th><td>{{ utility.description }}</td></tr>

          <tr><th>Team</th><td>{{ utility.developer }}</td></tr>

          <tr><th>Language</th><td>{{ utility.source_language or 'N/A' }}</td></tr>

          <tr><th>Transport</th><td>{{ utility.transport_type or 'N/A' }}</td></tr>

          <tr><th>Tools</th><td>{{ utility.utility_tools_number if utility.utility_tools_number is not none else utility.mcp_tools_number }}</td></tr>

          <tr><th>Committer</th><td>{{ utility.committer or 'N/A' }}</td></tr>

          {% if utility.server_url %}<tr><th>Server URL</th><td><a href="{{ utility.server_url }}" target="_blank">{{ utility.server_url }}</a></td></tr>{% endif %}

          {% if utility.source_code_url %}<tr><th>Source Code</th><td><a href="{{ utility.source_code_url }}" target="_blank">{{ utility.source_code_url }}</a></td></tr>{% endif %}

        </tbody>

      </table>

      <div class="config-wrapper">

        <h3 style="font-size:14px;font-weight:600;margin:0 0 8px;color:var(--hsbc-charcoal);">How to Use</h3>

        <button class="copy-btn" id="copyConfigBtn">Copy Steps</button>

        <pre id="configBlock">{{ utility.playbook if utility.playbook else 'No usage instructions provided' }}</pre>

      </div>

      <hr style="margin:28px 0;border:none;border-top:1px solid var(--hsbc-light);" />

      <p style="margin-top:32px;"><a class="back" href="/{{ app_name }}/home.html"><i class="fa fa-arrow-left"></i> Back to Dashboard</a></p>

    {% else %}

      <div class="not-found">

        <h1>Utility Not Found</h1>

        <p>The requested utility does not exist.</p>

        <p><a class="back" href="/{{ app_name }}/home.html">Back to Dashboard</a></p>

      </div>

    {% endif %}

  </div>

  <script>

    const btn = document.getElementById('copyConfigBtn');

    if(btn){

      btn.addEventListener('click',()=>{

        const pre = document.getElementById('configBlock');

        const text = pre ? pre.textContent : '';

        if(navigator.clipboard){

          navigator.clipboard.writeText(text).then(()=>{

            btn.textContent='Copied!';

            setTimeout(()=>btn.textContent='Copy Config',1600);

          });

        }

      });

    }

  </script>

  <script>

    const editBtn = document.getElementById('editUtilityBtn');

    if (editBtn) {

      editBtn.addEventListener('click', () => {

        // Encode utility data to pass to add-utility page

        const utilityData = {

          id: '{{ utility.id }}',

          title: '{{ utility.title }}',

          icon_url: '{{ utility.icon_url }}',

          description: `{{ utility.description }}`,

          developer: '{{ utility.developer }}',

          developer_source: '{{ utility.developer_source }}',

          server_url: '{{ utility.server_url }}',

          source_code_url: '{{ utility.source_code_url }}',

          type: '{{ utility.type }}',

          source_language: '{{ utility.source_language }}',

          status: '{{ utility.status }}',

          committer: '{{ utility.committer }}',

          playbook: `{{ utility.playbook if utility.playbook else '' }}`

        };

        // Store in sessionStorage and redirect

        sessionStorage.setItem('editUtility', JSON.stringify(utilityData));

        window.location.href = '/{{ app_name }}/add';

      });

    }

  </script>

</body>

</html>